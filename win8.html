<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>TouchDevelop</title>

    <!-- WinJS references -->
    <script src="//Microsoft.WinJS.2.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.2.0/js/ui.js"></script>

    <!-- Microsoft.TouchDevelop.Win8App references -->
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/editor.css" />
</head>
<body id="realRoot">
<div id="root">
<div id="loading" style="width: 200px; margin: 150px auto 0 auto; text-align: center; color: #81e774; font-family: sans-serif; ">
<svg style="width:200px;height:200px;" viewBox='0 0 480 480' preserveAspectRatio='xMinYMin' xmlns='http://www.w3.org/2000/svg' >
<path fill='#81E774' d='M 331,233C 284,233 245,195 245,147C 245,100 284,62 331,62C 378,62 417,100 417,147C 417,195 378,233 331,233 Z M 331,223C 373,223 406,189 406,147C 406,105 373,72 331,72C 289,72 255,105 255,147C 255,189 289,223 331,223 Z M 294,188L 297,173L 309,186L 294,188 Z M 316,183L 299,166L 343,122L 360,139L 316,183 Z M 364,136L 347,118L 350,115L 351,114C 356,109 363,110 368,114C 372,119 373,126 368,131L 367,132L 364,136 Z M 147,418C 100,418 62,379 62,332C 62,285 100,246 147,246C 194,246 233,285 233,332C 233,379 194,418 147,418 Z M 147,408C 189,408 223,374 223,332C 223,290 189,256 147,256C 105,256 72,290 72,332C 72,374 105,408 147,408 Z M 181,332L 130,370L 130,293L 181,332 Z M 331,417C 284,417 245,379 245,331C 245,284 284,246 331,246C 378,246 417,284 417,331C 417,379 378,417 331,417 Z M 331,407C 373,407 406,373 406,331C 406,290 373,256 331,256C 289,256 255,290 255,331C 255,373 289,407 331,407 Z M 320,356C 319,356 317,356 316,354C 315,353 314,352 314,350C 314,349 315,347 316,346C 317,345 319,344 320,344C 322,344 324,345 325,346C 326,347 327,349 327,350C 327,352 326,353 325,354C 324,356 322,356 320,356 Z M 320,321C 319,321 317,320 316,319C 315,318 314,316 314,315C 314,313 315,312 316,310C 317,309 319,309 320,309C 322,309 324,309 325,310C 326,312 327,313 327,315C 327,316 326,318 325,319C 324,320 322,321 320,321 Z M 341,370L 332,370C 342,359 346,346 346,331C 346,316 342,303 332,291L 341,291C 351,302 355,315 355,331C 355,346 351,359 341,370 Z M 147,233C 100,233 62,195 62,147C 62,100 100,62 147,62C 194,62 233,100 233,147C 233,195 194,233 147,233 Z M 147,223C 189,223 223,189 223,147C 223,105 189,72 147,72C 105,72 72,105 72,147C 72,189 105,223 147,223 Z M 150,160C 133,160 120,147 120,131C 120,115 133,102 150,102C 166,102 179,115 179,131C 179,147 166,160 150,160 Z M 150,152C 150,152 151,152 152,152L 158,132L 141,132L 147,152C 148,152 149,152 150,152 Z M 171,131C 171,119 162,109 150,109C 138,109 128,119 128,131C 128,140 133,148 141,151L 135,130L 135,129L 135,129C 135,129 135,128 136,128C 136,128 136,127 136,127C 137,127 137,127 137,127L 138,127L 161,127L 162,127L 162,127L 163,127L 163,128L 164,128C 164,128 164,129 164,129C 164,129 164,130 164,130L 158,151C 166,148 171,140 171,131 Z M 135,168L 135,163L 164,163L 164,166L 135,168 Z M 135,170L 164,168L 164,172L 135,174L 135,170 Z M 135,176L 164,174L 164,178L 136,180L 135,176 Z M 136,182L 141,181L 159,180L 163,180L 163,180L 163,182C 162,182 162,183 161,184C 161,185 160,186 159,187C 158,188 157,189 155,189C 153,190 152,191 150,191C 149,191 148,191 146,190C 145,190 144,190 143,189C 142,189 141,188 140,187C 139,186 138,186 138,185C 137,184 137,183 136,182L 136,182L 136,182 Z '></path>
</svg>
<div id="loadingDot" style="font-size: 18px;margin-top:-10px">we need JavaScript enabled</div>
<div id='progressContainer' style='margin-top:20px;height:3px;width:200px; background:#eee;'>
<div id='progressBar' style='height:3px; width:0px; background:#81e774'></div>
</div>
<div style="margin-top: 1em; font-size:12px;" id="statusMsg"></div>
</div>
<div id='scriptHolder'></div>
<script type="text/javascript">
    // these are used in the included JS files
    var browsersUrl = "browsers.html";
    var errorUrl = "error.html";
    var mainJsName = "./main.js";
    var betaFriendlyId = "";
    var rootUrl = "https://www.touchdevelop.com";
    var TDev;

    (function () {
        var e = document.getElementById("loadingDot");
        if (e) {
            e.innerHTML = 'just a moment';
        }
    }());
    (function () {
        var ratio = 0.97
        var curr = 195 / (1 / (1 - ratio))
        var sum = 0
        function updatePbar() {
            var pbar = document.getElementById("progressBar");
            if (!pbar) return;
            sum += curr
            curr *= ratio
            pbar.style.width = sum + "px"
            setTimeout(updatePbar, 200)
        }
        updatePbar();
    }());
    function statusMsg(m) {
        console.log(m);
    }
    var TDev;
    statusMsg("js initialized");
</script>
<style type="text/css">
    @import url("./css/default.css");
    @import url("./css/editor.css");
</style>
<script type="text/javascript"> statusMsg("css imported"); </script>
<script src="./browser.js" type="text/javascript"></script>
<script type="text/javascript">
    statusMsg("browser detector loaded");
    TDev.Browser.check(true);
    statusMsg("browser detector finished");
</script>
<script id='mainScript' src="./main.js" type="text/javascript"></script>
<script type="text/javascript">
    var app = WinJS.Application;
    var appModel = Windows.ApplicationModel;

    /*
    TDev.Cloud.getAccessToken = function(){
            var vault = new Windows.Security.Credentials.PasswordVault();
            try {
                var credential = vault.retrieve(Cloud.getServiceUrl(), "win8app");
                if (!!credential)
                    return credential.password;
            } catch (err) { }
            return undefined;
        };
    TDev.Cloud.setAccessToken = function(token) {
            var vault = new Windows.Security.Credentials.PasswordVault();
            if (!!token) {
                var credential = new Windows.Security.Credentials.PasswordCredential(Cloud.getServiceUrl(), "win8app", token);
                vault.add(credential);
            }
            else {
                try {
                    var credential = vault.retrieve(Cloud.getServiceUrl(), "win8app");
                    if (!!credential)
                        vault.remove(credential);
                } catch (err) { }
            }
        };
 */
        TDev.Intro.Name = "Early App Preview for Windows 8";
        TDev.Intro.Where = "in the app";
        TDev.Intro.Limitation = "Your device does not report to have";

    app.onactivated = function (eventObject) {
        if (eventObject.detail.kind === appModel.Activation.ActivationKind.launch) {
            if (eventObject.detail.previousExecutionState !== appModel.Activation.ApplicationExecutionState.terminated) {
                TDev.initAsync().done();
                TDev.RT.WinRT.ShareManagerWinRT.init();
                // TODO: This application has been newly launched. Initialize 
                // your application here.
            } else {
                // TODO: This application has been reactivated from suspension. 
                // Restore application state here.
            }
            WinJS.UI.processAll();
        } else if (eventObject.detail.kind === appModel.Activation.ActivationKind.shareTarget) {
            var so = eventObject.detail.shareOperation;
            if (so.data.contains(Windows.ApplicationModel.DataTransfer.StandardDataFormats.text)) {
                so.data.getTextAsync().then(function (text) {
                    if (text !== null) {
                        sharedText = text;
                        snapView = true;
                        onWallClose = function () { so.reportCompleted(); }
                        initAsync().done();
                    }
                }).done();
            }
        }
    };


    // print charm handled in printmanager
    app.oncheckpoint = function (ev) {
        // TODO: This application is about to be suspended. Save any state
        // that needs to persist across suspensions here. You might use the 
        // WinJS.Application.sessionState object, which is automatically
        // saved and restored across suspension. If you need to complete an
        // asynchronous operation before your application is suspended, call
        // eventObject.setPromise(). 

        if (!!TDev.TheEditor) eventObject.setPromise(TDev.TheEditor.saveStateAsync());
    };
    app.start();
</script>
</div>
</body>
</html>
